#!/bin/bash
PIPEX=./pipex

echo "=== Test 1 : fichier inexistant (chemin explicite) ==="
echo "hello" > infile
$PIPEX infile "./does_not_exist.sh" "wc -l" outfile
echo "pipex exit code = $?"
< infile ./does_not_exist.sh | wc -l > outfile.shell 2>/dev/null
echo "shell exit code = $?"
echo

echo "=== Test 2 : fichier non exécutable ==="
echo "echo hello" > non_exec.sh
chmod 000 non_exec.sh
$PIPEX infile "./non_exec.sh" "wc -l" outfile
echo "pipex exit code = $?"
< infile ./non_exec.sh | wc -l > outfile.shell 2>/dev/null
echo "shell exit code = $?"
echo

echo "=== Test 3 : commande introuvable au milieu ==="
$PIPEX infile "commande_inexistante" "wc -l" outfile
echo "pipex exit code = $?"
< infile commande_inexistante | wc -l > outfile.shell 2>/dev/null
echo "shell exit code = $?"
echo

echo "=== Test 4 : commande introuvable en dernier ==="
$PIPEX infile "cat" "commande_inexistante" outfile
echo "pipex exit code = $?"
< infile cat | commande_inexistante > outfile.shell 2>/dev/null
echo "shell exit code = $?"
echo

echo "=== Test 5 : succès normal ==="
echo "hello world" > infile
$PIPEX infile "cat" "wc -l" outfile
echo "pipex exit code = $?"
< infile cat | wc -l > outfile.shell
echo "shell exit code = $?"
echo
